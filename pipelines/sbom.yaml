- implementation: sbom:SBOMExtractor
  arguments:
    paths: data/

- implementation: nodestream.interpreting:Interpreter
  arguments:
    interpretations:
    - - type: source_node
        node_type: Document
        key:
          id: !jmespath __document_id
        properties:
          specVersion: !jmespath spec_version
          serialNumber: !jmespath serialNumber

      - type: relationship
        node_type: Component
        relationship_type: DESCRIBES
        node_key:
          id: !jmespath describes[*].__toId
        find_many: true

    - - type: source_node
        node_type: Component
        key:
          id: !jmespath __component_id
        properties:
          name: !jmespath name
      - type: relationship
        node_type: Reference
        relationship_type: REFERS_TO
        node_key:
          id: !jmespath references[*].__toId
        find_many: true

      - type: relationship
        node_type: Component
        relationship_type: DEPENDS_ON
        node_key:
          id: !jmespath dependsOn[*].__toId
        find_many: true

    - - type: source_node
        node_type: Reference
        key:
          id: !jmespath __reference_id
        properties:
          url: !jmespath url
          type: !jmespath type

    - - type: source_node
        node_type: Vulnerability
        key:
          id: !jmespath __vulnerability_id
        properties:
          vulnerability_id: !jmespath id
      - type: relationship
        node_type: Component
        relationship_type: AFFECTS
        node_key:
          id: !jmespath affects[*].__toId
        find_many: true
